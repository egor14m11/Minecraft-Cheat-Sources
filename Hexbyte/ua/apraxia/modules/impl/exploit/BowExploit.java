package ua.apraxia.modules.impl.exploit;

import net.minecraft.item.ItemBow;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.util.EnumHand;
import ua.apraxia.eventapi.EventTarget;
import ua.apraxia.eventapi.events.impl.packet.EventSendPacket;
import ua.apraxia.modules.Categories;
import ua.apraxia.modules.Module;
import ua.apraxia.modules.settings.impl.SliderSetting;

import static ua.apraxia.utility.Utility.mc;

public class BowExploit extends Module {

    private final SliderSetting power = new SliderSetting("Power", 0, 1, 100, 0.8f);
    public BowExploit() {
        super("BowExploit", Categories.Exploit);
        addSetting(power);
    }

    @EventTarget
    public void onEvent(EventSendPacket event) {
            if (((EventSendPacket) event).getPacket() instanceof CPacketPlayerDigging) {
                CPacketPlayerDigging packet = (CPacketPlayerDigging) ((EventSendPacket) event).getPacket();
                if (packet.getAction() == CPacketPlayerDigging.Action.RELEASE_USE_ITEM
                        && mc.player.getHeldItem(EnumHand.MAIN_HAND).getItem() instanceof ItemBow) {
                    mc.player.connection
                            .sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
                    for (int i = 0; i < power.value; i++) {
                        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX,
                                mc.player.posY + 1.0E-10, mc.player.posZ, false));
                        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX,
                                mc.player.posY - 1.0E-10, mc.player.posZ, true));
                    }
                }
            }
        }
    }
